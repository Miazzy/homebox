
# Basic site dedicated to the renewal of the certificate {{ certificate_fqdn }}
server {

    # Listen on port 80 on IPv4 and IPv6
    listen 80;
    listen [::]:80;

    server_name {{ certificate_fqdn }};

    root {{ site_root }};

    # log files per virtual host
    access_log /var/log/nginx/{{ certificate_fqdn }}-access.log;
    error_log /var/log/nginx/{{ certificate_fqdn }}-error.log;

    # Do not use a favicon
    location ~ ^/favicon.ico$ {
        log_not_found off;
        access_log off;
        expires max;
    }

{% if redirect_to_https == true %}
    # redirect inital requests to https
    location / {
        # Use Letsencrypt and force https
        rewrite ^ https://$server_name$request_uri? permanent;

        # log files per virtual host
        access_log /var/log/nginx/website-access.log;
        error_log /var/log/nginx/website-error.log;
    }
{% endif %}
}
